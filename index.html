<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>EcuaciÃ³n Interactiva</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }

    .ecuacion {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .lado {
      display: flex;
      gap: 10px;
      min-width: 150px;
      min-height: 50px;
      padding: 10px;
      background: #ffffff;
      border: 2px dashed #ccc;
      border-radius: 10px;
    }

    .bloque {
      padding: 10px 15px;
      background-color: #d1eaff;
      border: 2px solid #007acc;
      border-radius: 5px;
      cursor: grab;
      font-weight: bold;
    }

    .igual {
      font-size: 28px;
      font-weight: bold;
      margin: 0 10px;
      user-select: none;
    }

    .fraccion {
      display: flex;
      flex-direction: column;
      align-items: center;
      border: none;
      position: relative;
    }

    .linea-fraccion {
      width: 100%;
      height: 2px;
      background-color: black;
      margin: 4px 0;
    }

    h2 {
      text-align: center;
    }

    .botones {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    button {
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
    }

    .btn-x {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>

<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  

<!-- Modal para ingresar fÃ³rmula -->
<div id="modalFormula" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
  <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:500px; position:relative; display: flex; flex-direction: column;">
    <h3>ðŸ§® Escribe tu fÃ³rmula en LaTeX</h3>
    
    <textarea id="inputFormula" placeholder="Ej: x^2 + y^2 = z^2" style="width:100%; padding:10px; font-size:16px;"></textarea>



<!-- ðŸ”¢ TECLADO MATEMÃTICO PARA FÃ“RMULAS -->
<div id="tecladoLatex" style="display:flex; flex-wrap:wrap; gap:5px; margin-top:10px;">
      <button onclick="insertarSimbolo('\\frac{}{}')">\( \frac{a}{b} \)</button>
      <button onclick="insertarSimbolo('^{}')">x^{n}</button>
      <button onclick="insertarSimbolo('\\sqrt{}')">\( \sqrt{x} \)</button>
      <button onclick="insertarSimbolo('\\sqrt[n]{}')">\( \sqrt[n]{x} \)</button>
      <button onclick="insertarSimbolo('\\int_{}^{}')">\( \int \)</button>
      <button onclick="insertarSimbolo('\\sum_{}^{}')">\( \sum \)</button>
      <button onclick="insertarSimbolo('\\sin')">\( \sin \)</button>
      <button onclick="insertarSimbolo('\\cos')">\( \cos \)</button>
      <button onclick="insertarSimbolo('\\tan')">\( \tan \)</button>
      <button onclick="insertarSimbolo('\\log')">\( \log \)</button>
      <button onclick="insertarSimbolo('\\ln')">\( \ln \)</button>
      <button onclick="insertarSimbolo('\\pi')">\( \pi \)</button>
      <button onclick="insertarSimbolo('e')">e</button>
      <button onclick="insertarSimbolo('\\theta')">\( \theta \)</button>
      <button onclick="insertarSimbolo('\\cdot')">\( \cdot \)</button>
    </div>

    <div id="previewFormula" style="border:1px solid #ccc; border-radius:8px; padding:15px; margin-top:10px; min-height:50px; background:#f9f9f9;">Vista previa...</div>
    
    <div style="text-align:right; margin-top:10px;">
      <button onclick="cerrarModalFormula()">Cancelar</button>
      <button onclick="insertarFormula()">Insertar fÃ³rmula</button>
    </div>
  </div>
</div>


<script>

const formulasGuardadas = [];

  
  // Mostrar el teclado cuando se abre el modal
  function abrirModalFormula() {
    const secciones = document.querySelectorAll(".lado");
    if (secciones.length === 0) {
      alert("No hay secciones disponibles.");
      return;
    }

    let opciones = "";
    secciones.forEach((sec, index) => {
      const id = sec.id || `sin-id-${index}`;
      opciones += `${index + 1}: ${id}\n`;
    });

    const seleccion = prompt("Â¿En quÃ© secciÃ³n querÃ©s insertar la fÃ³rmula?\n" + opciones);
    const indice = parseInt(seleccion) - 1;

    if (!isNaN(indice) && secciones[indice]) {
      seccionActualParaFormula = secciones[indice];
      document.getElementById("modalFormula").style.display = "flex";
      document.getElementById("inputFormula").value = "";
      document.getElementById("previewFormula").innerHTML = "Vista previa...";
      document.getElementById("tecladoLatex").style.display = "flex"; // Mostrar el teclado
    } else {
      alert("SelecciÃ³n invÃ¡lida.");
    }
  }

  // Ocultar teclado al cerrar modal
  function cerrarModalFormula() {
    document.getElementById("modalFormula").style.display = "none";
    document.getElementById("tecladoLatex").style.display = "none";
    seccionActualParaFormula = null;
  }

  // Insertar sÃ­mbolo en textarea
  function insertarSimbolo(simbolo) {
    const input = document.getElementById("inputFormula");
    const start = input.selectionStart;
    const end = input.selectionEnd;
    const antes = input.value.substring(0, start);
    const despues = input.value.substring(end);
    input.value = antes + simbolo + despues;
    input.focus();
    input.selectionStart = input.selectionEnd = start + simbolo.length;
    input.dispatchEvent(new Event('input'));
  }
</script>



    
    <div id="previewFormula" style="border:1px solid #ccc; border-radius:8px; padding:15px; margin-top:10px; min-height:50px; background:#f9f9f9;">Vista previa...</div>
    <div style="text-align:right; margin-top:10px;">
      <button onclick="cerrarModalFormula()">Cancelar</button>
      <button onclick="insertarFormula()">Insertar fÃ³rmula</button>
    </div>
  </div>
</div>
  
  
<body>

  <h2>ðŸ”€ Mueve, edita, elimina o arma tus ecuaciones</h2>

  <div class="botones">
    <button onclick="abrirModalFormula()">âž• Insertar fÃ³rmula en cualquier secciÃ³n</button>
    <button onclick="agregarBloqueInteractivo()">âž• Agregar bloque a cualquier secciÃ³n</button>
    <button onclick="agregarSeccion()">âž• Agregar secciÃ³n</button>
    <button onclick="agregarBloque('numerador')">âž• Numerador</button>
    <button onclick="agregarBloque('denominador')">âž• Denominador</button>
    <button onclick="agregarFraccion()">âž• Agregar divisiÃ³n</button>
    <button onclick="agregarIgual()">âž• Agregar igualdad</button>

    <button onclick="guardarFormulaFinal()">âœ… Guardar fÃ³rmula completa</button>

    
  </div>

  <div class="ecuacion" id="contenedorEcuacion">
    <div class="lado" id="lado-izquierdo" ondrop="soltar(event)" ondragover="permitirSoltar(event)" style="position: relative;">
  <button class="btn-x" onclick="eliminar(this.parentElement)">Ã—</button>
      <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">+ 2x</div>
      <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">+ 5</div>

      <h3>ðŸ“š FÃ³rmulas guardadas</h3>
<div id="listaFormulas" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;"></div>

      
    </div>

    <div class="igual" onclick="eliminar(this)">=</div>

    <div class="fraccion">
      <button class="btn-x" onclick="eliminar(this.parentElement)">Ã—</button>
      <div class="lado" id="numerador" ondrop="soltar(event)" ondragover="permitirSoltar(event)">
        <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">8</div>
      </div>
      <div class="linea-fraccion"></div>
      <div class="lado" id="denominador" ondrop="soltar(event)" ondragover="permitirSoltar(event)">
        <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">1</div>
        <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">+ 2</div>
        <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">+ 3</div>
      </div>
    </div>

    <div class="igual" onclick="eliminar(this)">=</div>

    <div class="lado" id="lado-derecho" ondrop="soltar(event)" ondragover="permitirSoltar(event)" style="position: relative;">
  <button class="btn-x" onclick="eliminar(this.parentElement)">Ã—</button>
      <div class="bloque" draggable="true" ondragstart="arrastrar(event)" ondblclick="editar(this)" oncontextmenu="eliminar(this, event)">+ 9</div>
    </div>
  </div>

  <script>
    let bloqueArrastrado = null;

    function arrastrar(ev) {
      bloqueArrastrado = ev.target;
    }

    function permitirSoltar(ev) {
      ev.preventDefault();
    }

    function soltar(ev) {
      ev.preventDefault();
      if (bloqueArrastrado && ev.target.classList.contains('lado')) {
        ev.target.appendChild(bloqueArrastrado);
      }
    }

    function editar(bloque) {
      const nuevoTexto = prompt("Edita el contenido del bloque:", bloque.textContent);
      if (nuevoTexto !== null && nuevoTexto.trim() !== "") {
        bloque.textContent = nuevoTexto;
      }
    }

   function agregarBloque(ladoId) {
  const lado = document.getElementById(ladoId);
  if (!lado) {
    alert("Esa secciÃ³n ya no existe. Agrega una nueva secciÃ³n primero.");
    return;
  }

  const contenido = prompt("Contenido del nuevo bloque:");
  if (contenido !== null && contenido.trim() !== "") {
    const nuevoBloque = document.createElement("div");
    nuevoBloque.className = "bloque";
    nuevoBloque.draggable = true;
    nuevoBloque.ondragstart = arrastrar;
    nuevoBloque.ondblclick = function () { editar(nuevoBloque); };
    nuevoBloque.oncontextmenu = function (e) { eliminar(nuevoBloque, e); };
    nuevoBloque.textContent = contenido.trim();
    lado.appendChild(nuevoBloque);
  }
}

    function eliminar(elemento, evento = null) {
      if (evento) evento.preventDefault();
      if (confirm("Â¿Eliminar este elemento?")) {
        elemento.remove();
      }
    }

    function agregarFraccion() {
      const contenedor = document.getElementById("contenedorEcuacion");

      const fraccion = document.createElement("div");
      fraccion.className = "fraccion";

      const botonCerrar = document.createElement("button");
      botonCerrar.textContent = "Ã—";
      botonCerrar.className = "btn-x";
      botonCerrar.onclick = function () {
        eliminar(fraccion);
      };

      const numerador = document.createElement("div");
      numerador.className = "lado";
      numerador.ondrop = soltar;
      numerador.ondragover = permitirSoltar;

      const linea = document.createElement("div");
      linea.className = "linea-fraccion";

      const denominador = document.createElement("div");
      denominador.className = "lado";
      denominador.ondrop = soltar;
      denominador.ondragover = permitirSoltar;

      fraccion.appendChild(botonCerrar);
      fraccion.appendChild(numerador);
      fraccion.appendChild(linea);
      fraccion.appendChild(denominador);

      contenedor.appendChild(fraccion);
    }

    function agregarIgual() {
      const igual = document.createElement("div");
      igual.className = "igual";
      igual.textContent = "=";
      igual.onclick = function () {
        if (confirm("Â¿Eliminar este signo de igualdad?")) {
          igual.remove();
        }
      };
      document.getElementById("contenedorEcuacion").appendChild(igual);
    }

    
let contadorSecciones = 0;

function agregarSeccion() {
  const contenedor = document.getElementById("contenedorEcuacion");

  const lado = document.createElement("div");
  lado.className = "lado";
  lado.ondrop = soltar;
  lado.ondragover = permitirSoltar;

  // Asignar un ID Ãºnico para futuras referencias
  const nuevoID = "lado-dinamico-" + contadorSecciones++;
  lado.id = nuevoID;

  // BotÃ³n para eliminar la secciÃ³n
  const botonCerrar = document.createElement("button");
  botonCerrar.textContent = "Ã—";
  botonCerrar.className = "btn-x";
  botonCerrar.onclick = function () {
    eliminar(lado);
  };

  lado.style.position = "relative";
  lado.appendChild(botonCerrar);

  contenedor.appendChild(lado);

  // Preguntar si se desea agregar un bloque de inmediato
  if (confirm("Â¿Quieres agregar un bloque a esta nueva secciÃ³n?")) {
    agregarBloque(nuevoID);
  }
}


    function agregarBloqueInteractivo() {
  const secciones = document.querySelectorAll(".lado");
  if (secciones.length === 0) {
    alert("No hay secciones disponibles.");
    return;
  }

  let opciones = "";
  secciones.forEach((sec, index) => {
    const id = sec.id || `sin-id-${index}`;
    opciones += `${index + 1}: ${id}\n`;
  });

  const seleccion = prompt("Â¿A quÃ© secciÃ³n quieres agregar el bloque?\n" + opciones);
  const indice = parseInt(seleccion) - 1;

  if (!isNaN(indice) && secciones[indice]) {
    const contenido = prompt("Contenido del nuevo bloque:");
    if (contenido !== null && contenido.trim() !== "") {
      const nuevoBloque = document.createElement("div");
      nuevoBloque.className = "bloque";
      nuevoBloque.draggable = true;
      nuevoBloque.ondragstart = arrastrar;
      nuevoBloque.ondblclick = function () { editar(nuevoBloque); };
      nuevoBloque.oncontextmenu = function (e) { eliminar(nuevoBloque, e); };
      nuevoBloque.textContent = contenido.trim();
      secciones[indice].appendChild(nuevoBloque);
    }
  } else {
    alert("SelecciÃ³n invÃ¡lida.");
  }
}


// Modal de fÃ³rmula
let seccionActualParaFormula = null;

function abrirModalFormula() {
  const secciones = document.querySelectorAll(".lado");
  if (secciones.length === 0) {
    alert("No hay secciones disponibles.");
    return;
  }

  let opciones = "";
  secciones.forEach((sec, index) => {
    const id = sec.id || `sin-id-${index}`;
    opciones += `${index + 1}: ${id}\n`;
  });

  const seleccion = prompt("Â¿En quÃ© secciÃ³n querÃ©s insertar la fÃ³rmula?\n" + opciones);
  const indice = parseInt(seleccion) - 1;

  if (!isNaN(indice) && secciones[indice]) {
    seccionActualParaFormula = secciones[indice];
    document.getElementById("modalFormula").style.display = "flex";
    
    document.getElementById("tecladoLatex").style.display = "flex";
    
    document.getElementById("inputFormula").value = "";
    document.getElementById("previewFormula").innerHTML = "Vista previa...";
  } else {
    alert("SelecciÃ³n invÃ¡lida.");
  }
}

function cerrarModalFormula() {
  document.getElementById("modalFormula").style.display = "none";
  seccionActualParaFormula = null;
}

document.getElementById("inputFormula").addEventListener("input", () => {
  const tex = document.getElementById("inputFormula").value;
  document.getElementById("previewFormula").innerHTML = `\\(${tex}\\)`;
  MathJax.typesetPromise();
});

function insertarFormula() {
  const formula = document.getElementById("inputFormula").value;
  if (!seccionActualParaFormula || !formula.trim()) {
    alert("FÃ³rmula vacÃ­a o secciÃ³n no vÃ¡lida.");
    return;
  }

 // Insertar en la ecuaciÃ³n
  const bloque = document.createElement("div");
  bloque.className = "bloque";
  bloque.draggable = true;
  bloque.ondragstart = arrastrar;
  bloque.ondblclick = function () { editar(bloque); };
  bloque.oncontextmenu = function (e) { eliminar(bloque, e); };
  bloque.innerHTML = `\\(${formula}\\)`;
  seccionActualParaFormula.appendChild(bloque);
  MathJax.typesetPromise();

  // Guardar fÃ³rmula
  formulasGuardadas.push(formula);
  mostrarFormulasGuardadas();

  cerrarModalFormula();
}


   function mostrarFormulasGuardadas() {
  const contenedor = document.getElementById("listaFormulas");
  contenedor.innerHTML = "";
  formulasGuardadas.forEach((f, i) => {
    const div = document.createElement("div");
    div.className = "bloque";
    div.innerHTML = `\\(${f}\\)`;
    div.title = "Haz clic para copiar";
    div.style.cursor = "pointer";
    div.onclick = () => {
      navigator.clipboard.writeText(f);
      alert("ðŸ“‹ FÃ³rmula copiada:\n" + f);
    };
    contenedor.appendChild(div);
  });
  MathJax.typesetPromise();
}


    function guardarFormulaFinal() {
  const contenedor = document.getElementById("contenedorEcuacion");
  const partes = contenedor.querySelectorAll(".bloque");
  let latexCompleto = "";

  partes.forEach(bloque => {
    // Si es LaTeX renderizado (contiene span.MathJax)
    if (bloque.innerHTML.includes("MathJax")) {
      const tex = bloque.textContent;
      latexCompleto += tex + " ";
    } else {
      latexCompleto += bloque.textContent + " ";
    }
  });

  latexCompleto = latexCompleto.trim();
  if (latexCompleto) {
    formulasGuardadas.push(latexCompleto);
    localStorage.setItem("formulasGuardadas", JSON.stringify(formulasGuardadas));
    mostrarFormulasGuardadas();
    alert("âœ… FÃ³rmula guardada:\n" + latexCompleto);
  } else {
    alert("No hay contenido para guardar.");
  }
}
    
    
  </script>
</body>
</html>
